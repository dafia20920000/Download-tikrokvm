<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No18+ Tracker Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7b2cbf;
            --secondary: #240046;
            --success: #38b000;
            --danger: #d00000;
            --light: #f8f9fa;
            --dark: #212529;
            --gold: #ffd700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--secondary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loader {
            width: 80px;
            height: 80px;
            position: relative;
        }
        
        .loader-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 5px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }
        
        .loader-inner:nth-child(2) {
            border-top-color: var(--gold);
            animation-delay: 0.2s;
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
        }
        
        .loader-inner:nth-child(3) {
            border-top-color: var(--success);
            animation-delay: 0.4s;
            width: 50%;
            height: 50%;
            top: 25%;
            left: 25%;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-top: 30px;
            opacity: 0.8;
            letter-spacing: 1px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* Login Page */
        .login-container {
            width: 100%;
            max-width: 420px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
            margin: 2rem auto;
            transform: scale(0.95);
            opacity: 0;
            animation: scaleIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        @keyframes scaleIn {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(123, 44, 191, 0.15) 0%, transparent 70%);
            z-index: -1;
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .welcome-message {
            text-align: center;
            margin-bottom: 2.5rem;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.3s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .welcome-message h1 {
            font-size: 2.4rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #9d4edd, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
            font-weight: 700;
        }
        
        .welcome-message p {
            opacity: 0.8;
            font-size: 1.05rem;
            letter-spacing: 0.3px;
        }
        
        .input-group {
            margin-bottom: 1.8rem;
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.5s forwards;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 500;
            font-size: 1.05rem;
            letter-spacing: 0.3px;
        }
        
        .input-group input {
            width: 100%;
            padding: 1rem 1rem 1rem 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            letter-spacing: 0.5px;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(123, 44, 191, 0.2);
            box-shadow: 0 0 0 4px rgba(123, 44, 191, 0.15);
            transform: translateY(-2px);
        }
        
        .input-icon {
            position: absolute;
            left: 18px;
            top: 50px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus ~ .input-icon {
            color: var(--primary);
            transform: scale(1.1);
        }
        
        .btn-login {
            width: 100%;
            padding: 1.1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            margin-top: 1.5rem;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.7s forwards;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 0.5px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        .btn-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(123, 44, 191, 0.4);
        }
        
        .btn-login:hover::before {
            opacity: 1;
        }
        
        .btn-login:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 1.2rem;
            font-size: 0.95rem;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.3px;
        }
        
        /* Success Animation */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease;
        }
        
        .success-content {
            text-align: center;
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 6;
            stroke-miterlimit: 10;
            stroke: var(--success);
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .checkmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 6;
            stroke: var(--success);
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: 0 0 0 rgba(56, 176, 0, 0.4);
            animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
        }
        
        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
        
        @keyframes scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }
        
        @keyframes fill {
            100% { box-shadow: inset 0 0 0 100px rgba(56, 176, 0, 0); }
        }
        
        .success-text {
            color: white;
            font-size: 1.8rem;
            margin-top: 30px;
            font-weight: 600;
            letter-spacing: 0.5px;
            opacity: 0;
            animation: fadeIn 0.3s ease 1s forwards;
        }
        
        .success-subtext {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-top: 15px;
            opacity: 0;
            animation: fadeIn 0.3s ease 1.2s forwards;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary);
            opacity: 0;
        }
        
        /* Main App */
        .app-container {
            display: none;
            max-width: 1200px;
            margin: 2rem auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.6s ease;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.8rem;
            text-align: center;
            position: relative;
        }
        
        .app-header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .app-header p {
            opacity: 0.9;
            letter-spacing: 0.3px;
        }
        
        .date-display {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255,255,255,0.2);
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .main-content {
            padding: 2.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 1.8rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 5px solid var(--primary);
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 1rem;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        .stat-card .value {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary);
            transition: all 0.4s ease;
            display: inline-block;
            min-width: 80px;
        }
        
        .stat-card.success .value {
            color: var(--success);
        }
        
        .stat-card.danger .value {
            color: var(--danger);
        }
        
        .stat-card .value.changing {
            transform: scale(1.1);
            text-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 1rem 1.8rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            font-size: 1rem;
            letter-spacing: 0.3px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(123, 44, 191, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(123, 44, 191, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(123, 44, 191, 0.1);
            transform: translateY(-3px);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 1.2rem;
        }
        
        .day-card {
            background: white;
            border-radius: 14px;
            padding: 1.2rem;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
        }
        
        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .day-card.berhasil {
            background: linear-gradient(135deg, var(--success), #2b9348);
            color: white;
            border-color: var(--success);
        }
        
        .day-card.gagal {
            background: linear-gradient(135deg, var(--danger), #9d0208);
            color: white;
            border-color: var(--danger);
        }
        
        .day-number {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .day-status {
            font-size: 1.8rem;
            transition: all 0.3s ease;
        }
        
        .streak-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--gold);
            color: #333;
            font-size: 0.8rem;
            font-weight: bold;
            padding: 0.3rem 0.6rem;
            border-bottom-left-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .save-notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 1rem 1.8rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: none;
            z-index: 100;
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.4s ease forwards;
        }
        
        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .logout-btn {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Number Counter Animation */
        @keyframes pulseScale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .date-display {
                position: static;
                margin: 1rem auto 0;
                display: inline-block;
            }
            
            .app-header {
                padding-bottom: 2.5rem;
            }
            
            .logout-btn {
                top: 1rem;
                left: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .login-container {
                padding: 2rem 1.5rem;
                margin: 1rem;
                border-radius: 18px;
            }
            
            .welcome-message h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 1rem;
            }
            
            .day-card {
                padding: 1rem;
            }
            
            .day-number {
                font-size: 1.1rem;
            }
            
            .day-status {
                font-size: 1.5rem;
            }
            
            .stat-card {
                padding: 1.5rem;
            }
            
            .stat-card .value {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader">
            <div class="loader-inner"></div>
            <div class="loader-inner"></div>
            <div class="loader-inner"></div>
        </div>
        <div class="loading-text">Menyiapkan aplikasi...</div>
    </div>
    
    <!-- Login Page -->
    <div class="login-container" id="loginContainer">
        <div class="welcome-message">
            <h1>Selamat Datang</h1>
            <p>Tracker Kebiasaan Sehat No 18+</p>
        </div>
        
        <form id="loginForm">
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username" required>
                <i class="fas fa-user input-icon"></i>
            </div>
            
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password" required>
                <i class="fas fa-lock input-icon"></i>
            </div>
            
            <div class="error-message" id="errorMsg"></div>
            
            <button type="submit" class="btn-login" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Masuk
            </button>
        </form>
    </div>
    
    <!-- Success Animation -->
    <div class="success-animation" id="successAnimation">
        <div class="success-content">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <div class="success-text">Login Berhasil!</div>
            <div class="success-subtext">Mengarahkan ke dashboard...</div>
        </div>
        <div id="confetti-container"></div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <header class="app-header">
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Keluar
            </button>
            <h1><i class="fas fa-calendar-check"></i> No 18+ Tracker</h1>
            <p>Pantau kemajuan kebiasaan sehat Anda</p>
            <div class="date-display">
                <span id="current-date"></span>
            </div>
        </header>
        
        <div class="main-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Hari</h3>
                    <div class="value" id="total-hari">0</div>
                </div>
                <div class="stat-card success">
                    <h3>Berhasil</h3>
                    <div class="value" id="hari-berhasil">0</div>
                </div>
                <div class="stat-card danger">
                    <h3>Gagal</h3>
                    <div class="value" id="hari-gagal">0</div>
                </div>
                <div class="stat-card">
                    <h3>Persentase</h3>
                    <div class="value" id="persentase">0%</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" id="tambah-hari">
                    <i class="fas fa-plus"></i> Tambah Hari
                </button>
                <button class="btn btn-outline" id="reset">
                    <i class="fas fa-redo"></i> Reset
                </button>
                <button class="btn btn-outline" id="backup-btn">
                    <i class="fas fa-download"></i> Backup Data
                </button>
            </div>
            
            <div class="calendar-grid" id="kalender"></div>
        </div>
    </div>
    
    <div class="save-notification" id="saveNotif">
        <i class="fas fa-check-circle"></i> Data tersimpan otomatis!
    </div>

    <script>
        // Data
        let hari = [];
        let currentStreak = 0;
        let longestStreak = 0;
        
        // Key untuk localStorage
        const STORAGE_KEY = "no18plus_tracker_data";
        const AUTH_KEY = "no18plus_auth";
        
        // Elemen HTML
        const loadingScreen = document.getElementById('loadingScreen');
        const loginContainer = document.getElementById('loginContainer');
        const appContainer = document.getElementById('appContainer');
        const successAnimation = document.getElementById('successAnimation');
        const successContent = document.querySelector('.success-content');
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const errorMsg = document.getElementById('errorMsg');
        const saveNotif = document.getElementById('saveNotif');
        const confettiContainer = document.getElementById('confetti-container');
        
        // Inisialisasi data counter
        let currentValues = {
            total: 0,
            berhasil: 0,
            gagal: 0,
            persen: 0
        };

        // Simulasikan loading
        setTimeout(() => {
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                
                // Cek apakah sudah login
                const isLoggedIn = localStorage.getItem(AUTH_KEY);
                if (isLoggedIn) {
                    showApp();
                }
            }, 500);
        }, 2000);
        
        // Handle login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Disable tombol login saat proses
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memverifikasi...';
            
            // Simulasikan proses login
            setTimeout(() => {
                if (username === "dafian" && password === "stop18") {
                    // Login sukses
                    localStorage.setItem(AUTH_KEY, "true");
                    
                    // Tampilkan animasi sukses
                    successAnimation.style.opacity = '1';
                    successAnimation.style.pointerEvents = 'auto';
                    successContent.style.opacity = '1';
                    successContent.style.transform = 'scale(1)';
                    
                    // Buat efek confetti
                    createConfetti();
                    
                    // Sembunyikan form login
                    loginContainer.style.animation = 'scaleIn 0.5s ease reverse forwards';
                    
                    // Setelah animasi selesai, tampilkan app
                    setTimeout(() => {
                        loginContainer.style.display = 'none';
                        showApp();
                        
                        // Sembunyikan animasi sukses setelah 2.5 detik
                        setTimeout(() => {
                            successAnimation.style.opacity = '0';
                            successAnimation.style.pointerEvents = 'none';
                            successContent.style.opacity = '0';
                            successContent.style.transform = 'scale(0.8)';
                        }, 2500);
                    }, 500);
                } else {
                    // Login gagal
                    errorMsg.textContent = "Username atau password salah!";
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk';
                    
                    // Animasi error
                    loginForm.style.animation = 'shake 0.5s ease';
                    setTimeout(() => {
                        loginForm.style.animation = '';
                    }, 500);
                }
            }, 1500);
        });
        
        // Buat efek confetti
        function createConfetti() {
            confettiContainer.innerHTML = '';
            const colors = ['#7b2cbf', '#38b000', '#ffd700', '#d00000', '#4cc9f0'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = -10 + 'px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                confetti.style.opacity = Math.random() * 0.5 + 0.5;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                // Random animation
                const animationDuration = Math.random() * 3 + 2;
                const animationDelay = Math.random() * 2;
                confetti.style.animation = `float ${animationDuration}s ease-in ${animationDelay}s forwards`;
                
                confettiContainer.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => {
                    confetti.remove();
                }, (animationDuration + animationDelay) * 1000);
            }
        }
        
        // Handle logout
        logoutBtn.addEventListener('click', function() {
            localStorage.removeItem(AUTH_KEY);
            
            // Animasi keluar
            appContainer.style.opacity = '0';
            appContainer.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                appContainer.style.display = 'none';
                loginContainer.style.display = 'block';
                loginContainer.style.animation = 'scaleIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';
                
                // Reset form
                loginForm.reset();
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Masuk';
                errorMsg.textContent = "";
            }, 500);
        });
        
        // Tampilkan aplikasi utama
        function showApp() {
            appContainer.style.display = 'block';
            setTimeout(() => {
                appContainer.style.opacity = '1';
                appContainer.style.transform = 'translateY(0)';
            }, 50);
            initApp();
        }
        
        // Animasi counter angka yang lebih robust
        function animateValue(element, target, duration = 500) {
            const start = parseInt(element.textContent) || 0;
            const startTime = performance.now();
            
            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = Math.floor(start + (target - start) * progress);
                element.textContent = currentValue;
                
                // Add pulse effect
                element.classList.add('changing');
                setTimeout(() => {
                    element.classList.remove('changing');
                }, 300);
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            }
            
            requestAnimationFrame(updateValue);
        }
        
        // Load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    hari = parsedData.hari || [];
                    currentStreak = parsedData.currentStreak || 0;
                    longestStreak = parsedData.longestStreak || 0;
                    
                    // Update currentValues dengan data yang diload
                    currentValues.total = hari.length;
                    currentValues.berhasil = hari.filter(h => h.status === 'berhasil').length;
                    currentValues.gagal = hari.filter(h => h.status === 'gagal').length;
                    currentValues.persen = currentValues.total > 0 ? 
                        Math.round((currentValues.berhasil / currentValues.total) * 100) : 0;
                } catch (e) {
                    console.error("Gagal memuat data:", e);
                }
            }
        }
        
        // Save data ke localStorage
        function saveData() {
            const dataToSave = {
                hari: hari,
                currentStreak: currentStreak,
                longestStreak: longestStreak,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            
            // Tampilkan notifikasi
            saveNotif.style.display = 'flex';
            setTimeout(() => {
                saveNotif.style.display = 'none';
            }, 2500);
        }
        
        // Backup data
        document.getElementById('backup-btn').addEventListener('click', function() {
            const data = {
                hari: hari,
                currentStreak: currentStreak,
                longestStreak: longestStreak,
                lastUpdated: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `no18plus_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        });
        
        // Format tanggal
        function formatTanggal() {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return new Date().toLocaleDateString('id-ID', options);
        }
        
        // Update statistik dengan animasi yang lebih reliable
        function updateStatistik() {
            const total = hari.length;
            const berhasil = hari.filter(h => h.status === 'berhasil').length;
            const gagal = hari.filter(h => h.status === 'gagal').length;
            const persen = total > 0 ? Math.round((berhasil / total) * 100) : 0;
            
            // Hitung streak
            currentStreak = 0;
            for (let i = hari.length - 1; i >= 0; i--) {
                if (hari[i].status === 'berhasil') {
                    currentStreak++;
                } else {
                    break;
                }
            }
            
            // Update longest streak
            if (currentStreak > longestStreak) {
                longestStreak = currentStreak;
            }
            
            // Update DOM dengan animasi yang lebih aman
            const totalEl = document.getElementById('total-hari');
            const berhasilEl = document.getElementById('hari-berhasil');
            const gagalEl = document.getElementById('hari-gagal');
            const persenEl = document.getElementById('persentase');
            
            // Pastikan nilai tidak NaN atau undefined
            const safeTotal = isNaN(total) ? 0 : total;
            const safeBerhasil = isNaN(berhasil) ? 0 : berhasil;
            const safeGagal = isNaN(gagal) ? 0 : gagal;
            const safePersen = isNaN(persen) ? 0 : persen;
            
            // Animate values
            animateValue(totalEl, safeTotal);
            animateValue(berhasilEl, safeBerhasil);
            animateValue(gagalEl, safeGagal);
            
            // Handle percentage separately
            const currentPersenText = persenEl.textContent.replace('%', '');
            const currentPersen = parseInt(currentPersenText) || 0;
            
            let persenCounter = currentPersen;
            const persenInterval = setInterval(() => {
                if (persenCounter < safePersen) {
                    persenCounter++;
                } else if (persenCounter > safePersen) {
                    persenCounter--;
                } else {
                    clearInterval(persenInterval);
                    return;
                }
                
                persenEl.textContent = persenCounter + '%';
                persenEl.classList.add('changing');
                setTimeout(() => {
                    persenEl.classList.remove('changing');
                }, 300);
            }, 20);
            
            // Update currentValues
            currentValues = {
                total: safeTotal,
                berhasil: safeBerhasil,
                gagal: safeGagal,
                persen: safePersen
            };
            
            // Simpan data
            saveData();
        }
        
        // Gambar kalender dengan proteksi error
        function gambarKalender() {
            const kalenderEl = document.getElementById('kalender');
            if (!kalenderEl) return;
            
            try {
                kalenderEl.innerHTML = '';
                
                hari.forEach((item, index) => {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'day-card';
                    if (item && item.status) dayEl.classList.add(item.status);
                    
                    // Tambah badge streak jika >= 3 hari berturut-turut
                    if (item.status === 'berhasil' && currentStreak >= 3 && 
                        index >= hari.length - currentStreak) {
                        const streakValue = currentStreak - (hari.length - 1 - index);
                        dayEl.innerHTML += `<span class="streak-badge">${streakValue}🔥</span>`;
                    }
                    
                    dayEl.innerHTML += `
                        <div class="day-number">Hari ${index + 1}</div>
                        <div class="day-status">${item.status === 'berhasil' ? '✅' : item.status === 'gagal' ? '❌' : ''}</div>
                    `;
                    
                    dayEl.addEventListener('click', () => {
                        if (!item.status) {
                            item.status = 'berhasil';
                        } else if (item.status === 'berhasil') {
                            item.status = 'gagal';
                        } else {
                            item.status = '';
                        }
                        gambarKalender();
                        updateStatistik();
                    });
                    
                    kalenderEl.appendChild(dayEl);
                });
            } catch (error) {
                console.error("Error rendering calendar:", error);
            }
        }
        
        // Tambah hari baru dengan validasi
        document.getElementById('tambah-hari').addEventListener('click', function() {
            try {
                hari.push({ status: '' });
                gambarKalender();
                updateStatistik();
            } catch (error) {
                console.error("Error adding day:", error);
                // Reset data jika error
                hari = [];
                currentStreak = 0;
                longestStreak = 0;
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        });
        
        // Reset data dengan confirmasi
        document.getElementById('reset').addEventListener('click', function() {
            if (confirm('Yakin ingin mengatur ulang semua progres?')) {
                try {
                    hari = [];
                    currentStreak = 0;
                    longestStreak = 0;
                    localStorage.removeItem(STORAGE_KEY);
                    
                    // Tambah 7 hari default setelah reset
                    for (let i = 0; i < 7; i++) {
                        hari.push({ status: '' });
                    }
                    
                    gambarKalender();
                    updateStatistik();
                } catch (error) {
                    console.error("Error resetting data:", error);
                    location.reload();
                }
            }
        });
        
        // Initialize app dengan error handling
        function initApp() {
            try {
                document.getElementById('current-date').textContent = formatTanggal();
                loadData();
                
                // Jika data kosong, buat 7 hari default
                if (hari.length === 0) {
                    for (let i = 0; i < 7; i++) {
                        hari.push({ status: '' });
                    }
                }
                
                gambarKalender();
                updateStatistik();
                
                // Auto-save setiap 30 detik
                setInterval(saveData, 30000);
            } catch (error) {
                console.error("Error initializing app:", error);
                // Jika error saat init, reset data
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(AUTH_KEY);
                location.reload();
            }
        }
    </script>
</body>
</html>
