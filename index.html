<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No18+ Tracker (Auto Save)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7b2cbf;
            --secondary: #240046;
            --success: #38b000;
            --danger: #d00000;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5, #e9ecef);
            min-height: 100vh;
            padding: 2rem;
            color: var(--dark);
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ... (CSS lainnya sama seperti sebelumnya) ... */
    </style>
</head>
<body>
    <!-- HTML sama seperti sebelumnya -->
    
    <script>
        // Data
        let hari = [];
        let currentStreak = 0;
        let longestStreak = 0;
        
        // Key untuk localStorage
        const STORAGE_KEY = "no18plus_tracker_data";
        
        // Load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                hari = parsedData.hari || [];
                currentStreak = parsedData.currentStreak || 0;
                longestStreak = parsedData.longestStreak || 0;
            }
        }
        
        // Save data ke localStorage
        function saveData() {
            const dataToSave = {
                hari: hari,
                currentStreak: currentStreak,
                longestStreak: longestStreak,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
        }
        
        // Format tanggal
        function formatTanggal() {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return new Date().toLocaleDateString('id-ID', options);
        }
        
        // Update statistik
        function updateStatistik() {
            const total = hari.length;
            const berhasil = hari.filter(h => h.status === 'berhasil').length;
            const gagal = hari.filter(h => h.status === 'gagal').length;
            const persen = total > 0 ? Math.round((berhasil / total) * 100) : 0;
            
            // Hitung streak
            currentStreak = 0;
            for (let i = hari.length - 1; i >= 0; i--) {
                if (hari[i].status === 'berhasil') {
                    currentStreak++;
                } else {
                    break;
                }
            }
            
            // Update longest streak
            if (currentStreak > longestStreak) {
                longestStreak = currentStreak;
            }
            
            // Update DOM
            document.getElementById('total-hari').textContent = total;
            document.getElementById('hari-berhasil').textContent = berhasil;
            document.getElementById('hari-gagal').textContent = gagal;
            document.getElementById('persentase').textContent = persen + '%';
            
            // Simpan data
            saveData();
        }
        
        // Gambar kalender
        function gambarKalender() {
            kalenderEl.innerHTML = '';
            
            hari.forEach((item, index) => {
                const dayEl = document.createElement('div');
                dayEl.className = 'day-card';
                if (item.status) dayEl.classList.add(item.status);
                
                if (item.status === 'berhasil' && currentStreak >= 3 && 
                    index >= hari.length - currentStreak) {
                    const streakValue = currentStreak - (hari.length - 1 - index);
                    dayEl.innerHTML += `<span class="streak-badge">${streakValue}üî•</span>`;
                }
                
                dayEl.innerHTML += `
                    <div class="day-number">Hari ${index + 1}</div>
                    <div class="day-status">${item.status === 'berhasil' ? '‚úÖ' : item.status === 'gagal' ? '‚ùå' : ''}</div>
                `;
                
                dayEl.addEventListener('click', () => {
                    if (!item.status) {
                        item.status = 'berhasil';
                    } else if (item.status === 'berhasil') {
                        item.status = 'gagal';
                    } else {
                        item.status = '';
                    }
                    gambarKalender();
                    updateStatistik();
                });
                
                kalenderEl.appendChild(dayEl);
            });
        }
        
        // Event listeners
        tambahHariBtn.addEventListener('click', () => {
            hari.push({ status: '' });
            gambarKalender();
            updateStatistik();
        });
        
        resetBtn.addEventListener('click', () => {
            if (confirm('Yakin ingin mengatur ulang semua progres?')) {
                hari = [];
                currentStreak = 0;
                longestStreak = 0;
                localStorage.removeItem(STORAGE_KEY);
                gambarKalender();
                updateStatistik();
            }
        });
        
        // Inisialisasi
        currentDateEl.textContent = formatTanggal();
        loadData();
        
        // Jika data kosong, buat 7 hari default
        if (hari.length === 0) {
            for (let i = 0; i < 7; i++) {
                hari.push({ status: '' });
            }
        }
        
        gambarKalender();
        updateStatistik();
        
        // Auto-save saat tab ditutup
        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>
